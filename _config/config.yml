---
Name: forager-bifrost
Only:
  envvarset: 'BIFROST_MANAGEMENT_API_KEY'
After:
  - 'silverstripe-forager-elastic-enterprise'
  - 'search-forager-default'
---
SilverStripe\Core\Injector\Injector:
  SilverStripe\Forager\Service\IndexConfiguration:
    constructor:
      index_variant: '`BIFROST_ENGINE_PREFIX`'
  SilverStripe\Forager\Interfaces\IndexingInterface:
    class: SilverStripe\ForagerBifrost\Service\BifrostService
    constructor:
      client: '%$Elastic\EnterpriseSearch\Client'
      configuration: '%$SilverStripe\Forager\Service\IndexConfiguration'
      builder: '%$SilverStripe\Forager\Service\DocumentBuilder'
  Elastic\EnterpriseSearch\Client:
    factory: SilverStripe\ForagerBifrost\Service\ClientFactory
    constructor:
      host: '`BIFROST_ENDPOINT`'
      token: '`BIFROST_MANAGEMENT_API_KEY`'
      http_client: '%$GuzzleHttp\Client'
  Elastic\EnterpriseSearch\AppSearch\Request\CreateEngine:
    class: SilverStripe\ForagerBifrost\Service\Requests\PostEngine
  Elastic\EnterpriseSearch\AppSearch\Request\DeleteDocuments:
    class: SilverStripe\ForagerBifrost\Service\Requests\DeleteDocuments
  Elastic\EnterpriseSearch\AppSearch\Request\GetSchema:
    class: SilverStripe\ForagerBifrost\Service\Requests\GetSchema
  Elastic\EnterpriseSearch\AppSearch\Request\IndexDocuments:
    class: SilverStripe\ForagerBifrost\Service\Requests\PostDocuments
  Elastic\EnterpriseSearch\AppSearch\Request\ListDocuments:
    class: SilverStripe\ForagerBifrost\Service\Requests\GetDocumentsList
  Elastic\EnterpriseSearch\AppSearch\Request\ListEngines:
    class: SilverStripe\ForagerBifrost\Service\Requests\GetEngines
  Elastic\EnterpriseSearch\AppSearch\Request\PutSchema:
    class: SilverStripe\ForagerBifrost\Service\Requests\PostSchema

## customise the dataobject fields for Bifrost compatability
SilverStripe\Forager\DataObject\DataObjectDocument:
  id_field: record_id
  base_class_field: record_base_class
  page_content_field: page_content
